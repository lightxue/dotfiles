# {é¡¹ç›®åç§°} - æ¥å£æ–‡æ¡£

> å…³è”æ–‡æ¡£ï¼š[README](README.md) | [æ¶æ„è®¾è®¡](architecture.md) | [å®ç°ç»†èŠ‚](implementation.md)

## 1. æ¥å£æ€»è§ˆ

### 1.1 æ¥å£åˆ†ç»„ç´¢å¼•

**è¯´æ˜**ï¼š
- âœ… æ ¸å¿ƒæ¥å£ï¼ˆæ ‡æ³¨â­ï¼‰åœ¨ç¬¬2èŠ‚æä¾›è¯¦ç»†å®šä¹‰
- âœ… ä¸šåŠ¡æµç¨‹å›¾è§ [å®ç°ç»†èŠ‚](implementation.md)
- âœ… ä»£ç ä½ç½®æ ¼å¼ï¼š`æ–‡ä»¶è·¯å¾„:èµ·å§‹è¡Œ-ç»“æŸè¡Œ`

| åˆ†ç»„ | æ¥å£æ•°é‡ | ä»£è¡¨æ¥å£ | è¯¦ç»†æ–‡æ¡£ |
|------|---------|---------|---------|
| è®¤è¯ç›¸å…³ | 3ä¸ª | `POST /api/v1/login` â­ | [Â§2.1](#21-ç”¨æˆ·ç™»å½•æ¥å£) |
| ç”¨æˆ·ç®¡ç† | 5ä¸ª | `GET /api/v1/user` â­ | [Â§2.2](#22-è·å–ç”¨æˆ·ä¿¡æ¯æ¥å£) |
| {å…¶ä»–åˆ†ç»„} | {N}ä¸ª | {ä»£è¡¨æ¥å£} | [é“¾æ¥] |

### 1.2 å®Œæ•´æ¥å£åˆ—è¡¨

| æ¥å£åç§° | åè®® | åŠŸèƒ½ | ä»£ç ä½ç½® | è®¤è¯ |
|---------|------|------|---------|------|
| `/api/v1/login` | POST | ç”¨æˆ·ç™»å½• | `api/login_api.go:10-50` | å¦ |
| `/api/v1/logout` | POST | ç”¨æˆ·ç™»å‡º | `api/login_api.go:60-80` | æ˜¯ |
| `/api/v1/user` | GET | è·å–ç”¨æˆ·ä¿¡æ¯ | `api/user_api.go:10-40` | æ˜¯ |
| `/api/v1/user` | PUT | æ›´æ–°ç”¨æˆ·ä¿¡æ¯ | `api/user_api.go:50-90` | æ˜¯ |
| `/api/v1/user` | DELETE | åˆ é™¤ç”¨æˆ· | `api/user_api.go:100-130` | æ˜¯ |

### 1.3 é”™è¯¯ç è§„èŒƒ

| é”™è¯¯ç  | è¯´æ˜ | HTTPçŠ¶æ€ç  | è§£å†³æ–¹æ¡ˆ |
|-------|------|-----------| ---------|
| 0 | æˆåŠŸ | 200 | - |
| 40001 | ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯ | 401 | æ£€æŸ¥å‡­è¯ |
| 40002 | è´¦æˆ·å·²è¢«é”å®š | 403 | 15åˆ†é’Ÿåé‡è¯• |
| 40003 | å‚æ•°éªŒè¯å¤±è´¥ | 400 | æ£€æŸ¥å‚æ•°æ ¼å¼ |
| 40004 | ä»¤ç‰Œæ— æ•ˆæˆ–è¿‡æœŸ | 401 | é‡æ–°ç™»å½• |
| 50001 | æ•°æ®åº“é”™è¯¯ | 500 | è”ç³»ç®¡ç†å‘˜ |
| 50002 | ç¼“å­˜æœåŠ¡å¼‚å¸¸ | 500 | ç³»ç»Ÿé™çº§è¿è¡Œ |

## 2. æ ¸å¿ƒæ¥å£è¯¦ç»†å®šä¹‰

### 2.1 ç”¨æˆ·ç™»å½•æ¥å£ â­

#### åŸºæœ¬ä¿¡æ¯
- **è·¯å¾„**ï¼š`POST /api/v1/login`
- **åŠŸèƒ½**ï¼šéªŒè¯ç”¨æˆ·åå¯†ç ï¼Œè¿”å›JWTä»¤ç‰Œ
- **ä»£ç ä½ç½®**ï¼š`api/login_api.go:10-50`
- **ä¸šåŠ¡æµç¨‹å›¾**ï¼šè§ [implementation.md Â§ 1.1](implementation.md#11-ç”¨æˆ·è®¤è¯æµç¨‹)

#### è¯·æ±‚å‚æ•°
```json
{
  "username": "string",  // å¿…å¡«ï¼Œ2-50å­—ç¬¦ï¼Œä»…å­—æ¯æ•°å­—ä¸‹åˆ’çº¿
  "password": "string"   // å¿…å¡«ï¼Œ8-100å­—ç¬¦
}
```

#### å“åº”æ ¼å¼

**æˆåŠŸï¼ˆ200ï¼‰**ï¼š
```json
{
  "code": 0,
  "message": "ç™»å½•æˆåŠŸ",
  "data": {
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "expires_at": 1699257600,
    "user_info": {
      "user_id": 123,
      "username": "testuser",
      "email": "test@example.com"
    }
  }
}
```

**å¤±è´¥ï¼ˆ401/403ï¼‰**ï¼š
```json
{
  "code": 40001,  // 40001=å¯†ç é”™è¯¯, 40002=è´¦æˆ·é”å®š
  "message": "ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯",
  "data": null
}
```

#### æ ¸å¿ƒé€»è¾‘
1. å‚æ•°éªŒè¯ â†’ é”å®šæ£€æŸ¥ â†’ ç”¨æˆ·æŸ¥è¯¢ â†’ å¯†ç éªŒè¯ â†’ å¤±è´¥è®¡æ•° â†’ JWTç”Ÿæˆ
2. **å®‰å…¨ç­–ç•¥**ï¼š5æ¬¡å¤±è´¥é”å®š15åˆ†é’Ÿï¼ŒbcryptåŠ å¯†ï¼ŒJWT 24hè¿‡æœŸ
3. **è¯¦ç»†æµç¨‹**ï¼šè§ [implementation.md Â§ 1.1](implementation.md#11-ç”¨æˆ·è®¤è¯æµç¨‹)

---

### 2.2 è·å–ç”¨æˆ·ä¿¡æ¯æ¥å£ â­

#### åŸºæœ¬ä¿¡æ¯
- **è·¯å¾„**ï¼š`GET /api/v1/user?user_id={id}`
- **åŠŸèƒ½**ï¼šæ ¹æ®ç”¨æˆ·IDè·å–ç”¨æˆ·è¯¦ç»†ä¿¡æ¯
- **ä»£ç ä½ç½®**ï¼š`api/user_api.go:10-40`
- **è®¤è¯è¦æ±‚**ï¼šéœ€JWTä»¤ç‰Œï¼ˆHeader: `Authorization: Bearer <token>`ï¼‰

#### è¯·æ±‚å‚æ•°
```
Query: user_id=123 (å¿…å¡«)
Header: Authorization: Bearer <token>
```

#### å“åº”æ ¼å¼

**æˆåŠŸï¼ˆ200ï¼‰**ï¼š
```json
{
  "code": 0,
  "message": "æŸ¥è¯¢æˆåŠŸ",
  "data": {
    "user_id": 123,
    "username": "testuser",
    "email": "test@example.com",
    "status": 1,
    "created_at": "2024-01-01T00:00:00Z"
  }
}
```

**å¤±è´¥ï¼ˆ401ï¼‰**ï¼š
```json
{
  "code": 40004,
  "message": "ä»¤ç‰Œæ— æ•ˆæˆ–è¿‡æœŸ",
  "data": null
}
```

#### æ ¸å¿ƒé€»è¾‘
1. JWTéªŒè¯ â†’ æŸ¥è¯¢ç¼“å­˜ â†’ ç¼“å­˜æœªå‘½ä¸­æ—¶æŸ¥æ•°æ®åº“ â†’ å†™å…¥ç¼“å­˜
2. **ç¼“å­˜ç­–ç•¥**ï¼šKey=`user:{id}`ï¼ŒTTL=1hï¼ŒCache-Asideæ¨¡å¼
3. **è¯¦ç»†æµç¨‹**ï¼šè§ [implementation.md Â§ 1.2](implementation.md#12-ç¼“å­˜æ›´æ–°æµç¨‹)

---

### 2.3 å…¶ä»–æ¥å£

| æ¥å£ | è·¯å¾„ | ä»£ç ä½ç½® | æ ¸å¿ƒæµç¨‹ |
|------|------|---------|---------|
| æ›´æ–°ç”¨æˆ· | `PUT /api/v1/user` | `api/user_api.go:50-90` | JWTéªŒè¯ â†’ æƒé™æ£€æŸ¥ â†’ æ›´æ–°DB â†’ åˆ ç¼“å­˜ |
| åˆ é™¤ç”¨æˆ· | `DELETE /api/v1/user` | `api/user_api.go:100-130` | JWTéªŒè¯ â†’ è½¯åˆ é™¤ â†’ åˆ ç¼“å­˜ |
| ç”¨æˆ·ç™»å‡º | `POST /api/v1/logout` | `api/login_api.go:60-80` | JWTéªŒè¯ â†’ ä»¤ç‰ŒåŠ å…¥é»‘åå• |

---

## 3. æ¥å£è°ƒç”¨çº¦å®š

### 3.1 é€šç”¨å“åº”æ ¼å¼

```json
{
  "code": 0,           // 0=æˆåŠŸ, å…¶ä»–=é”™è¯¯ç ï¼ˆè§Â§1.3ï¼‰
  "message": "string", // æç¤ºä¿¡æ¯
  "data": {}           // ä¸šåŠ¡æ•°æ®
}
```

### 3.2 è®¤è¯æ–¹å¼

éœ€è®¤è¯çš„æ¥å£åœ¨Headerä¸­æºå¸¦ï¼š`Authorization: Bearer <JWT_TOKEN>`

### 3.3 åˆ†é¡µæ ¼å¼

**è¯·æ±‚**ï¼š`?page=1&page_size=20`ï¼ˆé»˜è®¤20ï¼Œæœ€å¤§100ï¼‰  
**å“åº”**ï¼š`{"list": [...], "total": 100, "page": 1, "total_pages": 5}`

---

**ğŸ“– ä¸‹ä¸€æ­¥**ï¼šæŸ¥çœ‹ [å®ç°ç»†èŠ‚](implementation.md) äº†è§£ä¸šåŠ¡æµç¨‹å›¾å’Œä»£ç å®ç°ç»†èŠ‚
