# {功能名称} - 任务规划

> 文档路径：.specs/{feature_name}-{requirement_id}/tasks.md
> 创建时间：{YYYY-MM-DD}
> 需求来源：【{需求标题}】{需求来源链接或描述}
> 关联设计：.specs/{feature_name}-{requirement_id}/design.md

## 任务约定

- 最小单元：10-15 分钟
- 状态：todo / doing / done
- **执行模式：分组执行 → 人工确认 → 下一分组（必须遵守）**
- 严格按 design.md 执行

## 分组执行计划

> **⚠️ 重要提醒**：
> - ✅ 完成分组X的所有任务后，**必须停止**等待用户确认
> - ❌ 不要自动推进到下一分组
> - 有效确认用语：`确认无误` `没问题` `可以` `继续` `同意` `通过` `没有问题`

> **📌 分组数量说明**：
> - 根据实际任务数量动态调整分组数量，下方仅为示例模板
> - **简单需求**：4-5个分组（含2个强制分组）
> - **中等需求**：5-6个分组（含2个强制分组）
> - **复杂需求**：6-8个分组（含2个强制分组）
> - **分组原则**：每组3-5个任务（约30-60分钟）、按依赖关系分组、关键路径优先、独立可验证
> - **强制分组**：
>   - 分组 N-1：文档更新与验证（T{N-1}、T{N}，其中T{N}使用 spec-workflow skill 验证）
>   - 分组 N：最终验收与审批（T{N+1}、T{N+2}、T{N+3}、T{N+4}，全部使用 spec-workflow skill）

### 分组 1：{分组名称}（示例）

**执行顺序**：第 1 组

**⭐ 前置条件（必须全部满足）**：
- ✅ 阶段 2 任务规划已审批通过
- ✅ 已了解阶段 3 执行要求

**依赖**：无

**预计时间**：{总时间}

> **📌 说明**：根据实际需求调整分组数量和任务内容，每组建议3-5个任务
>
> **🔴 强制规则**：
> - 完成此分组的所有任务后，**AI必须停止**
> - 等待用户确认（需用户回复确认词语）后才能继续分组 2

- [ ] T1 {任务标题}
  - 描述：{详细描述}
  - 设计参考：design.md - {章节}
  - 文件操作：新增/修改/删除 {文件路径}
  - 预计用时：15m
  - 状态：todo
  - 分组：分组 1
  - 产出：PR/提交号

<!-- 根据需要添加更多任务 T2, T3... -->

### 分组 N-1：文档更新与验证⭐

**执行顺序**：倒数第二组

**⭐ 前置条件（必须全部满足）**：
- ✅ 分组 1～N-2 的所有任务已完成
- ✅ 每个分组都已获得用户确认

**依赖**：所有功能分组完成 + 用户已逐分组确认

**预计时间**：30分钟

**分组目标**：确保项目文档与代码变更保持同步

> **📌 说明**：此分组为强制分组，必须包含在所有任务规划中
> **📌 任务编号**：使用连续编号，如前面最后任务是T9，则此处为T10、T11
> **📌 用户确认要点**：
> - wiki文档是否完整反映本次变更
> - 接口文档是否准确
> - 代码位置标注是否正确
> - mermaid图是否清晰

- [ ] T{N-1} 更新项目wiki文档
  - 描述：根据本次需求变更更新 doc/ 目录下的文档，反映所有变更内容
  - 设计参考：design.md - 全部章节
  - 更新内容：
    - 新增接口需更新 interfaces.md（接口表格、请求响应格式）
    - 新增业务流程需更新 implementation.md（流程图、关键实现）
    - 架构调整需更新 architecture.md（架构图、模块划分）
    - 数据模型变更需更新 architecture.md（Schema、Redis设计）
    - 启动方式/技术栈变更需更新 README.md
  - 文件操作：按需修改 doc/README.md、doc/architecture.md、doc/interfaces.md、doc/implementation.md
  - 预计用时：20m
  - 状态：todo
  - 分组：分组 N-1

- [ ] T{N} 验证wiki文档完整性
  - 描述：使用 spec-workflow skill 运行验证脚本，确保wiki文档通过所有检查
  - 设计参考：N/A（流程验证任务）
  - 文件操作：无（仅验证）
  - 执行方式：`use_skill("spec-workflow")` 验证wiki文档
  - 验证命令：`python3 <SKILL_DIR>/scripts/validate_wiki.py doc/`
  - 验证内容：4个文档存在性、接口全量性、mermaid图、代码位置标注、内容完整性
  - 预计用时：10m
  - 状态：todo
  - 分组：分组 N-1
  - ⚠️ 必须通过（exit code = 0）才能完成本分组

---


### 分组 N：最终验收与审批⭐

**执行顺序**：最后一组

**⭐ 前置条件（必须全部满足）**：
- ✅ 分组 N-1 完成
- ✅ 用户已明确确认进入分组 N

**依赖**：分组 N-1 完成 + 用户明确确认

**预计时间**：35分钟

**分组目标**：完成质量检查、生成执行总结、通过人工审批

> **📌 说明**：此分组为强制分组，使用 spec-workflow skill 执行
> **📌 任务编号**：延续前面编号，如前面最后是T{N}，则此处为T{N+1}至T{N+4}
> **📌 Skill使用说明**：
> - 分组N-1使用skill：验证wiki文档质量（validate_wiki.py）
> - 分组N使用skill：验证任务完成+质量检查+生成总结+审批（4个任务全部用skill）
> **📖 详细说明**：执行细节参见 [阶段3-任务执行详情](../../references/phases/phase-3-execution.md#任务执行详情参考)

- [ ] T{N+1} 验证任务完成状态
  - 描述：使用 spec-workflow skill 验证所有任务状态已为 done（已完成）
  - 设计参考：N/A（流程验证任务）
  - 文件操作：无（仅验证）
  - 验证命令：`python3 <SKILL_DIR>/scripts/validate_tasks.py .specs/{feature_name}-{requirement_id}/tasks.md --phase execution`
  - 预计用时：5m
  - 状态：todo
  - 分组：分组 N
  - ⚠️ 必须通过（exit code = 0）才能继续

- [ ] T{N+2} 最终质量检查
  - 描述：执行最终质量检查清单，确保所有CRITICAL项通过
  - 设计参考：N/A（质量检查任务）
  - 文件操作：无（检查任务）
  - 检查项目：**CRITICAL**（单元测试覆盖率≥80%、回归测试通过）、**IMPORTANT**（集成测试通过）
  - 预计用时：15m
  - 状态：todo
  - 分组：分组 N
  - ⚠️ CRITICAL项必须通过，否则禁止完成阶段3

- [ ] T{N+3} 生成执行总结文档
  - 描述：基于模板生成 execution_summary.md，记录执行概况、代码变更、质量检查报告
  - 设计参考：N/A（文档生成任务）
  - 文件操作：新增 .specs/{feature_name}-{requirement_id}/execution_summary.md
  - 模板路径：<SKILL_DIR>/assets/templates/execution_summary.md.template
  - 输出路径：.specs/{feature_name}-{requirement_id}/execution_summary.md
  - 核心内容：执行概况、代码变更总结、质量检查报告、Wiki更新确认、需求验收确认、遗留问题与优化建议
  - 预计用时：10m
  - 状态：todo
  - 分组：分组 N

- [ ] T{N+4} 等待人工审批
  - 描述：等待用户审批，使用有效审批用语执行审批命令
  - 设计参考：N/A（审批流程任务）
  - 文件操作：无（人工审批）
  - 审批命令：`python3 <SKILL_DIR>/scripts/phase_gateway.py --approve-phase 3 --approval "<当前对话用户回复的审批原文>" --approver "<当前对话的用户名称>"`
  - 有效用语：`审批通过` `确认无误` `同意` `批准` `可以` `没问题`
  - 预计用时：5m
  - 状态：todo
  - 分组：分组 N
  - ⚠️ 必须使用有效审批用语，审批通过后工作流完成

## 分组执行顺序

1. **功能分组**（分组1至N-2）：按依赖顺序执行代码实现
2. **分组N-1**：文档更新与验证（依赖：所有功能分组完成 → 需用户确认wiki质量）
3. **分组N**：最终验收与审批（依赖：分组N-1完成 + 用户确认 → 需人工审批通过）

## 分组执行状态

> **说明**：此处用于追踪每个分组的执行和确认状态
> - 分组完成：所有任务状态 = done
> - 用户确认：收到用户的确认回复

| 分组 | 任务数 | 完成状态 | 用户确认 | 备注 |
|------|-------|---------|---------|------|
| 分组 1 | ? | ⬜ | ⬜ | 第一个功能分组 |
| 分组 2 | ? | ⬜ | ⬜ | 第二个功能分组 |
| ... | ? | ⬜ | ⬜ | ... |
| 分组 N-1 | 2 | ⬜ | ⬜ | 文档更新与验证 ⭐ |
| 分组 N | 4 | ⬜ | ⬜ | 最终验收与审批 ⭐ |

**图例**：
- ✅ = 完成（分组完成 + 用户确认）
- ⏳ = 进行中
- ⬜ = 待执行
- ❌ = 失败（需返工）

## 验收清单

> **说明**：
>
> - 本清单用于验证需求是否完整实现
> - **❗️ 强制要求**：所有验收项必须在阶段3完成后全部勾选
> - **审批门禁**：阶段3审批时，系统会自动检查是否有未勾选的验收项
> - **解决方法**：
>   - 将已完成的验收项改为 `- [x]`（勾选）
>   - 如某些验收项不适用，请删除或标注原因
> - **⚠️ 注意**：存在未勾选项时，无法通过阶段3审批！

### 功能验收

- [ ] 所有分组执行完成并确认
- [ ] 所有任务状态为 done
- [ ] 需求的所有功能点已实现
- [ ] 需求的验收标准已满足

### 质量验收

- [ ] 代码审查通过
- [ ] 单元测试覆盖率 ≥80%
- [ ] 回归测试通过
- [ ] 性能测试通过（如需要）

### 文档验收

- [ ] 接口文档已更新
- [ ] wiki 文档已更新（T{N-1} 完成）
- [ ] wiki 文档已验证（T{N} 通过）
- [ ] 代码注释完整

### 部署验收（如涉及后端变更，可选）

- [ ] 发布方案已制定（含灰度/回滚策略）_（可选：仅当涉及后端部署时勾选）_
- [ ] 监控告警已配置_（可选：仅当涉及后端部署时勾选）_

---

> **📌 完成标志**：所有分组执行完成，分组N审批通过后，本任务规划文档完成使命
> 
> **📖 延伸阅读**：
> - 详细执行流程参见：[阶段3: 计划执行](../../references/phases/phase-3-execution.md)
> - 最终验收与审批详见：分组N的4个任务（T{N+1}-T{N+4}）
> - 执行总结文档：`.specs/{feature_name}-{requirement_id}/execution_summary.md`（由T{N+3}生成）
