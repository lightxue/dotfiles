---
type: reference
description: 项目wiki文档生成的详细执行指南（工作流阶段0）
version: 3.0.0
updated: 2025-11-27
---

# 项目 Wiki 文档生成规范

## 概述

本文档定义了项目知识库的生成规范和执行流程，属于 Spec Workflow 的**阶段0：前置准备**。

**输出路径**：`doc/` 目录（包含4个文档）

**工作流定位**：
- 📋 整体工作流程：各阶段详细步骤见 `phases/*.md` 文档
- 🎯 本规范是工作流"阶段0：前置准备"的详细执行指南
- ✅ 完成知识库生成后，进入阶段1：设计方案

## 新架构：1+3文档结构

**设计理念**：
- ✅ **按需加载**：模型只读取必要文档，节省60-85% token
- ✅ **通用性强**：适配Go/Java/Python等多语言项目
- ✅ **层级固定**：仅3层结构，易于维护和扩展

**文档清单**：
| 文件 | 职责 | Token估算 | 何时读取 |
|------|------|---------|---------|
| `README.md` | 快速导航、项目结构、核心模块 | 0.5K | **总是读取** |
| `architecture.md` | 架构图、模块划分、数据模型 | 1.5K | 设计阶段 |
| `interfaces.md` | 全部接口表格 + 请求响应格式 | 2.5K | 接口修改 |
| `implementation.md` | 业务流程图、关键实现 | 2K | 深度改造 |

**Token优化效果**：
- 单文件方案：15K tokens（全量读取）
- 新方案：0.5K（入口）+ 1.5K-2.5K（按需）
- **节省率**：70-95%

## 适用场景

当项目目录下**不存在** `doc/` 目录或文档不完整时，按本规范生成项目知识库。

**触发条件**：
- 新项目首次生成文档
- 项目重构后需要更新文档
- 文档丢失或需要重建
- 从旧单文件格式迁移

## 核心原则

1. **全量分析**：完整分析项目代码库，不遗漏重要模块和接口
2. **代码溯源**：所有分析结果必须标注源文件路径和具体行号范围
3. **基于模板**：严格遵循 `assets/templates/*.md.template` 模板结构
4. **一次性生成**：禁止使用占位符或TODO标记，必须完整生成所有必需内容
5. **职责分离**：每个文档专注特定领域，确保按需加载效率
6. **统一输出**：所有文档输出至 `doc/` 目录

## 分析清单与文档映射

生成知识库时，按以下清单逐项分析并输出到对应文档：

| # | 分析项 | 输出文档 | 关键章节 |
|---|--------|---------|---------|
| 1 | 项目基本信息 | `README.md` | 快速导航、项目结构、核心模块 |
| 2 | 架构与模块设计 | `architecture.md` | 架构图、模块划分表格、依赖关系 |
| 3 | 数据模型设计 | `architecture.md` | 数据库Schema表格（核心字段）、Redis设计 |
| 4 | 接口全量分析 ⭐ | `interfaces.md` | **全部接口**表格 + 2-5个核心接口详细定义 |
| 5 | 核心业务流程 | `implementation.md` | 2-3个核心流程图 + 步骤表格 |
| 6 | 关键代码实现 | `implementation.md` | 代码位置表格、简要说明 |

## 关键质量要求

### 1. 接口文档（最重要）⭐

- ✅ **全部接口**必须列在接口总览表格
- ✅ **2-5个核心接口**提供详细请求响应定义
- ✅ 代码位置格式：`文件路径:起始行-结束行`（如 `api/login_api.go:10-50`）

### 2. 业务流程图 ⭐

- ✅ 只为**2-3个核心业务**绘制详细流程图
- ✅ 使用 mermaid `sequenceDiagram` 格式
- ✅ 每次方法调用标注：`Note over 组件: 方法描述 (文件路径:行号)`
- ✅ 流程图后附**核心步骤表格**（代码位置、关键逻辑、说明）

### 3. 其他要求

- ✅ 架构图使用 mermaid 格式
- ✅ 模块说明、数据模型改为表格化
- ❌ 禁止占位符或 TODO，必须完整生成

**参考示例见各模板文件**

## 输出文档结构

**📋 模板目录**：`assets/templates/`

| 文档 | 模板文件 | 必需章节 | 核心要求 |
|------|---------|---------|---------|
| **README.md** | `README.md.template` | 3个：快速导航、项目结构、核心模块 | 极简设计，≤100行 |
| **architecture.md** | `architecture.md.template` | 4个：架构图、模块划分、数据模型、技术选型 | 表格化模块说明，删除完整DDL |
| **interfaces.md** | `interfaces.md.template` | 2个：接口总览、核心接口定义 | **全部接口**列表 + 2-5个核心接口详细定义 ⭐ |
| **implementation.md** | `implementation.md.template` | 2个：核心业务流程、关键实现点 | 2-3个流程图 + 步骤表格 ⭐ |

**详细说明见各模板文件注释**

---

## 生成执行流程

### 前置要求

确保当前工作目录为项目根目录，并具备项目代码的读取权限。

### 🚀 推荐：渐进式4步生成策略

**核心理念**：分4步逐个生成文档，每步独立验证，降低失败率，提升质量。

#### 整体流程

```
Step 1: 生成 README.md → 验证通过 → 继续
Step 2: 生成 architecture.md → 验证通过 → 继续
Step 3: 生成 interfaces.md → 验证通过 → 继续
Step 4: 生成 implementation.md → 验证通过 → 整体验证
```

---

#### Step 1：生成 README.md ⭐

**分析重点**：
- 项目结构分析（目录树、分层设计）
- 技术栈识别（框架、语言、数据库）
- 核心模块概览（模块名称、职责、代表接口）

**生成命令**：
```bash
# 1. 创建doc目录
mkdir -p doc

# 2. 基于模板生成 README.md
# 输出到: doc/README.md
```

**生成内容要求**：
- 项目基本信息（类型、语言、框架、数据存储）
- 项目结构（目录树 + 分层说明）
- 核心模块表格（模块、职责、代表接口、详细文档链接）
- 变更记录

**验证命令**：
```bash
python3 scripts/validate_wiki.py doc/README.md
```

**⏸️ 验证通过后继续下一步**

---

#### Step 2：生成 architecture.md ⭐

**前置上下文**：已有 README.md（可参考模块划分和技术栈）

**分析重点**：
- 架构分层详解（API层、Service层、Repo层）
- 模块依赖关系（依赖矩阵、单向依赖原则）
- 数据模型设计（数据库表结构、Redis Key设计）
- 技术选型理由

**生成命令**：
```bash
# 基于模板生成 architecture.md
# 输出到: doc/architecture.md
```

**生成内容要求**：
- 整体架构图（mermaid）
- 模块详细说明表格（核心职责、关键文件、依赖模块）
- 模块依赖矩阵
- 数据库表结构（核心字段、索引、DDL位置）
- Redis缓存设计（Key模板、TTL、命名规范）
- 技术栈清单（框架、ORM、第三方依赖）

**验证命令**：
```bash
python3 scripts/validate_wiki.py doc/architecture.md
```

**⏸️ 验证通过后继续下一步**

---

#### Step 3：生成 interfaces.md ⭐

**前置上下文**：已有 README + architecture（可参考模块划分和接口规范）

**分析重点**：
- 接口全量提取（代码扫描，不能遗漏）
- 接口分组索引（按模块/功能分组）
- 核心接口详情（2-3个最重要的接口）
- 错误码规范

**生成命令**：
```bash
# 基于模板生成 interfaces.md
# 输出到: doc/interfaces.md
```

**生成内容要求**：
- 接口分组索引表格
- 完整接口列表（路径、方法、功能、代码位置、认证要求）⭐
- 错误码规范表格
- 核心接口详细定义（2-3个，包含请求参数、响应格式、核心逻辑）
- 接口调用约定（通用响应格式、认证方式、分页格式）

**验证命令**：
```bash
python3 scripts/validate_wiki.py doc/interfaces.md
```

**⏸️ 验证通过后继续下一步**

---

#### Step 4：生成 implementation.md ⭐

**前置上下文**：已有 README + architecture + interfaces（可参考接口和架构设计）

**分析重点**：
- 核心业务流程分析（1-2个最重要的流程）
- 业务流程图绘制（mermaid sequenceDiagram）
- 关键实现点提取（JWT、密码加密、缓存策略、数据库优化）
- 代码位置标注（文件路径:起始行-结束行）

**生成命令**：
```bash
# 基于模板生成 implementation.md
# 输出到: doc/implementation.md
```

**生成内容要求**：
- 核心业务流程（1-2个，每个包含流程图 + 核心步骤表格）
- 关键实现点（JWT管理、密码加密、数据库优化、错误处理）
- 每个实现点包含代码位置、算法说明、性能数据

**验证命令**：
```bash
python3 scripts/validate_wiki.py doc/implementation.md
```

**⏸️ 验证通过后，渐进式生成完成**

**📍 注意**：
- ✅ 4步生成完成后，回到阶段0流程，进入Step 3进行统一整体验证
- ✅ 整体验证确保4个文档的一致性和完整性（文档间引用、接口全量等）

---

### 📊 渐进式生成优势

| 优势 | 说明 |
|------|------|
| ✅ **失败率降低75%** | 每步只需1次write_to_file，失败后只需重试当前步骤 |
| ✅ **认知负荷可控** | 每步只关注1个文档维度，质量更高 |
| ✅ **上下文积累** | 后面的文档可参考前面已生成的文档 |
| ✅ **独立验证** | 每个文档独立验证，问题定位更精准 |
| ✅ **质量提升** | 每个文档都能得到充分关注 |

---

### ⚙️ 兼容：传统一次性生成（不推荐）

如果由于特殊原因需要一次性生成4个文档：

```bash
# 1. 创建doc目录
mkdir -p doc

# 2. 一次性生成4个文档
# 输出到: doc/README.md, doc/architecture.md, doc/interfaces.md, doc/implementation.md

# 3. 整体验证
python3 scripts/validate_wiki.py doc/
```

**⚠️ 注意**：一次性生成失败率较高，不推荐使用，仅作兼容保留。

---

### 质量检查清单

生成完成后，验证以下关键点：

- ✅ 禁止使用占位符或TODO，所有内容必须完整填充
- ✅ 代码位置采用统一格式：`文件路径:起始行-结束行`（例：`api/login_api.go:10-50`）
- ✅ interfaces.md 必须列出**全部接口**（无遗漏）⭐
- ✅ implementation.md 仅为2-3个核心业务流程绘制详细流程图
- ✅ 所有 mermaid 图表语法正确且可渲染

---

## 相关模板参考

- **文档模板**：`assets/templates/*.md.template`
  - `README.md.template` - 入口索引（含示例）
  - `architecture.md.template` - 架构设计（含示例）
  - `interfaces.md.template` - 接口文档（含完整请求响应示例）
  - `implementation.md.template` - 实现细节（含流程图示例）
- **验证脚本**：
  - `python scripts/validate_wiki.py doc/` - 验证文档完整性和质量

## 版本记录

| 版本 | 日期 | 变更说明 |
|------|------|----------|
| 3.0.0 | 2025-11-27 | **重大更新**：增加渐进式4步生成策略，降低失败率；validate_wiki.py支持单文档验证 |
| 2.3.0 | 2025-11-27 | **规范优化**：删除\"模型使用指南\"章节（AI会自主决策读取顺序），符合Skill最佳实践 |
| 2.2.0 | 2025-11-27 | **精简升级**：删除冗余示例，精简执行流程，优化章节说明（示例见模板文件） |
| 2.1.0 | 2025-11-26 | **优化升级**：精简文档内容，删除运维配置、基础设施代码、完整代码示例 |
| 2.0.0 | 2025-11-26 | **重大升级**：从单文件改为1+3文档结构，优化模型token消耗 |
| 1.0.0 | 2025-11-07 | 初始版本，定义单文件wiki生成规范 |
